@==================================================================
@==================================================================
@
@ arm_caches.s
@
@ Functions for setting up the caches on the ARM Cortex A9 MP Core
@
@==================================================================
@==================================================================



@==================================================================
@==================================================================
@ Constant Definitions
@==================================================================
@==================================================================

@ This is the memory-mapped address of the L2 cache controller (L2C-310) on the ARM-v9a

.equ L2CC_PL310, 0x39004000



@==================================================================
@==================================================================
@ Data Section
@
@ This section includes the following data structures:
@	* Level 1 Translation Table
@==================================================================
@==================================================================

.data



@==================================================================
@==================================================================
@ Text Section
@
@ This section includes the following functions:
@	* enable_SCU()
@	* enable_L2_speculative_linefill()
@==================================================================
@==================================================================

.text

@==================================================================
@==================================================================
@ Enable Everything
@==================================================================
@==================================================================



@==================================================================
@==================================================================
@  SCU Enable
@==================================================================
@==================================================================
	.align
	.global  enable_SCU
	.type    enable_SCU, %function
	@ void enable_SCU(void)
	@ Enables the SCU
enable_SCU:
	MRC     p15, 4, r0, c15, c0, 0     @ Read periph base address
	@ SCU offset from base of private peripheral space = 0x000

	LDR     r1, [r0, #0x0]             @ Read the SCU Control Register
	ORR     r1, r1, #0x1               @ Set bit 0 (The Enable bit)
	STR     r1, [r0, #0x0]             @ Write back modifed value

	BX      lr


@==================================================================
@==================================================================
@  Enable L2 Speculative Linefill in SCU
@==================================================================
@==================================================================
	.align
	.global  enable_L2_speculative_linefill
	.type    enable_L2_speculative_linefill, %function
	@ void enable_L2_speculative_linefill(void)
	@ Enables the SCU
enable_L2_speculative_linefill:
	MRC     p15, 4, r0, c15, c0, 0     @ Read periph base address
	@ SCU offset from base of private peripheral space = 0x000

	LDR     r1, [r0, #0x0]             @ Read the SCU Control Register
	ORR     r1, r1, #0x8               @ Set bit 3 (Speculative L2 linefill)
	STR     r1, [r0, #0x0]             @ Write back modifed value

	BX      lr


.end

@==================================================================
@  End of file
@==================================================================

